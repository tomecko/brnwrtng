<template name="brainSession">

    {{> brainSession_modals linkForParticipants=linkForParticipants linkForAdmins=linkForAdmins title=title}}

    <div class="container-fluid">
        <div class="row">

            <div class="col-sm-9">
                <div class="well">
                    <div class="row" style="margin-bottom: 30px;">
                        <div class="{{#if isSuperuser}}col-sm-8{{else}}col-sm-12{{/if}}">
                            {{> brainSession_info linkForParticipants=linkForParticipants title=title}}
                        </div>
                        {{#if isSuperuser}}
                        <div class="col-sm-4 text-right">
                            {{> brainSession_action round=round}}
                        </div>
                        {{/if}}
                    </div>
                    <div class="row {{#unless round}}disabled{{/unless}}">
                        {{#unless closed}}
                        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
                            <h2 style="margin-top:0">Your ideas</h2>
                            {{> brainSession_progress}}
                            {{> brainSession_ideas_current_round}}
                        </div>
                        {{/unless}}
                        <div class="{{#if closed}}col-xs-12{{else}}col-xs-12 col-sm-12 col-md-6 col-lg-6{{/if}}">
                            {{> brainSession_ideas}}
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-sm-3">
                <div class="well">
                    {{> brainSession_logo}}
                    {{> brainSession_participants}}
                    {{> brainSession_chat}}
                </div>
            </div>

        </div>
    </div>

</template>

<template name="brainSession_logo">
    <div id="logo" class="text-center">
        <a href="/"><img src="/brainwrite.it.jpg" width="150"></a>
    </div>
</template>

<template name="brainSession_action">
    {{#if round}}
        {{#unless ../closed}}
            <button id="main-action-button" class="btn btn-warning btn-lg end-session">
                <i class="fa fa-eject"></i>
                End
                <span class="hidden-xs hidden-sm hidden-md">Brainwriting</span>
            </button>
        {{/unless}}
    {{else}}
        <button id="main-action-button" class="btn btn-success btn-lg next-round">
            <i class="fa fa-play"></i>
            Start
            <span class="hidden-xs hidden-sm hidden-md">Brainwriting</span>
        </button>
    {{/if}}
</template>

<template name="XbrainSession">

    {{> brainSession_modals linkForParticipants=linkForParticipants linkForAdmins=linkForAdmins title=title}}
        
    <div class="container-fluid">
    <div class="row">
        
        <div class="col-sm-3" id="side-col">
            <div class="well well-sm">
                {{#unless closed}}
                    <div class="text-center">
                        {{> brainSession_round_info}}
                        {{> brainSession_timer}}
                    </div>
                    <hr/>
                {{/unless}}
                {{> brainSession_participants}}
                <hr/>
                {{> brainSession_chat}}
            </div>
        </div>
        
        <div class="col-sm-9">
            <div class="well well-sm">
                {{> brainSession_info linkForParticipants=linkForParticipants title=title}}
                <hr>
                {{#if closed}}
                    {{> brainSession_ideas}}
                {{else}}
                    {{#if round}}
                        <div class="row">
                            <div class="col-sm-4">
                                {{> brainSession_ideas_current_round}}
                            </div>
                            <div class="col-sm-8">
                                {{> brainSession_ideas}}
                            </div>
                        </div>
                    {{else}}
                        <h2>Session hasn't begun yet.</h2>
                    {{/if}}
                {{/if}}
            </div>
        </div>

    </div>
    </div>
</template>

<template name="brainSession_round_info">
    <h2 class="text-center">
        {{#if round}}
            Round {{round}}
        {{else}}
            Not started
        {{/if}}
    </h2>
</template>

<template name="brainSession_info">
    
    <h2 id="session-title" class="{{#if isSuperuser}}session-edit-modal-open clickable{{/if}} {{#unless title}}empty{{/unless}}">
        {{#if title}}
            {{title}}
        {{else}}
            No subject
        {{/if}}
        {{#if isSuperuser}}
            <small><i class="fa fa-pencil"></i></small>
        {{/if}}
    </h2>

</template>

<template name="brainSession_timer">
    <h2 id="timer" class="clearfix text-center {{#if _lt timerSeconds 5}}warn{{/if}}">
        <div id="timer-knob" data-minutes="{{roundLength}}">
            <input type="text" value="0" class="dial">
        </div>
        <div>
            {{formatDuration timerSeconds}}
        </div>
    </h2>
    {{#unless closed}}
        {{#if isSuperuser}}
            {{#if round}}
                {{#if shortened}}
                    <button class="next-round-undo btn btn-primary">Undo</button>
                {{else}}
                    <button class="next-round btn btn-primary" data-toggle="tooltip" data-animation="true" data-html="true" data-placement="bottom" data-trigger="manual" data-title="It seems everybody&#39;s<br/>ready for the next round.<br/>You may want to click<br/>&quot;Next Round&quot; button.">Next Round</button>&nbsp;<button class="end-session btn btn-default">End Brainwriting</button>
                {{/if}}
            {{else}}
                <button class="next-round btn btn-lg btn-primary">Start Brainwriting</button>
            {{/if}}
        {{/if}}
    {{/unless}}
</template>

<template name="brainSession_participants">
     {{#if participants}}
        <h2>People
            {{#if isSuperuser}}
                <button class="btn btn-sm btn-warning session-links-modal-open">
                    <i class="fa fa-plus"></i> invite
                </button>
            {{/if}}
            {{!--<small>({{getLength participants}})</small>--}}
        </h2>
        <ul class="list-group blink blink-fast">
        {{#each participants}}
            <li class="list-group-item {{#if activity.ready}}active{{/if}}">
                {{#unless ../closed}}
                    <i class="fa fa-fw fa-check-circle primary-color" style="{{#if activity.ready}}color:#fff;{{/if}}"></i>
                {{/unless}}
                
                <span class="{{#if _eq currentUser._id this._id}}name-edit-modal-open clickable{{/if}}">
                    {{userName this}}
                    {{#if _eq currentUser._id this._id}}<small><i class="fa fa-pencil"></i></small>{{/if}}
                </span>
                
                {{#if activity.write}}
                    <i class="fa fa-bolt faa-shake animated" style="margin-left: 5px;"></i>
                {{/if}}
            </li>
        {{/each}}
        </ul>
    {{/if}}
</template>

<template name="brainSession_chat">
    <h2>Chat</h2>
    {{#if messages}}
        <ul class="list-unstyled" id="chat">
        {{#each messages}}
            <li>
                <span class="label {{#if _neq author currentUser._id}}label-primary{{else}}label-default{{/if}}">{{userNameById author}}:</span>
                {{text}}
                <span class="text-muted" title="{{formatDate time 'YYYY/MM/DD HH:mm'}}">{{formatDate time 'HH:mm'}}</span>
            </li>
        {{else}}
            <li><em>be first to write a message!</em></li>
        {{/each}}
        </ul>
    {{/if}}
    <form id="chat-send-message">
        <input type="text" class="form-control" placeholder="your message">
    </form>
</template>

<template name="brainSession_ideas">
    
    {{#if closed}}
        <h2>
            All ideas
            <button class="btn btn-warning" onclick="alert('Sorry, this hasn\'t been implemented yet!\n\nWhat did you expect to happen?');">
                export to file
            </button>
        </h2>
        <p>
            sort by
            <div class="btn-group all-ideas-sorting">
                <button class="btn {{#if sessionEquals 'allIdeasSorting' 'round'}}btn-warning{{else}}btn-default{{/if}}" data-sort-by="round">round</button>
                <button class="btn {{#if sessionEquals 'allIdeasSorting' 'author'}}btn-warning{{else}}btn-default{{/if}}" data-sort-by="author">author</button>
                <button class="btn {{#if sessionEquals 'allIdeasSorting' 'likes'}}btn-warning{{else}}btn-default{{/if}}" data-sort-by="likes">likes</button>
            </div>
        </p>
    {{else}}
        <h2 style="margin-top: 0;">Random ideas <span class="hidden-xs hidden-sm hidden-md">for inspiration</span></h2>
    {{/if}}

    <div class="clearfix">
    {{#each ideas}}
        {{#if text}}
            <div class="{{#if ../closed}}col-xs-4{{/if}}">
                <div class="well well-sm idea-box">
                    <small>
                        <span class="text-muted">round {{round}}</span>
                        {{#if ../closed}}
                            | <span class="text-muted">by {{userName author}}</span>
                            <span class="pull-right">{{#if _len likedBy}}{{_len likedBy}}{{/if}} <i class="fa fa-thumbs{{#unless _inArray likedBy currentUser._id}}-o{{/unless}}-up primary-color idea-box-like clickable" title="{{#if _inArray likedBy currentUser._id}}unlike{{else}}like{{/if}}"></i></span>
                        {{/if}}
                    </small>
                    <br/>
                    {{{nlToBreak text}}}
                </div>
            </div>
        {{/if}}
    {{else}}
        <div class="well text-muted">no ideas yet</div>
    {{/each}}
    </div>
    
</template>

<template name="brainSession_progress">
    <div class="clearfix" style="margin-bottom: 10px; margin-top: 20px;">
<!--         <div class="no-padding col-xs-3 col-sm-2 col-md-2 col-lg-2 brwr-timer text-center">
        </div> -->
        <div class="no-padding col-xs-9 col-sm-5 col-md-4 col-lg-5">
            <div class="progress brwr-progress-lg">
                <div class="progress-bar progress-bar-striped {{#if round}}active{{/if}} {{#if _lt timer.percentage '50'}}progress-bar-warning{{/if}} {{#if _lt timer.percentage '16'}}progress-bar-danger{{/if}}" role="progressbar" aria-valuenow="{{timer.percentage}}" aria-valuemin="0" aria-valuemax="100" style="width: {{timer.percentage}}%;">
                    {{formatDuration timer.seconds}}
                </div>
            </div>
        </div>
        <div class="no-padding col-xs-12 col-sm-5 col-md-6 col-lg-5 text-right">
            <span class="brwr-round-info" style="padding-right: 8px;">Round {{round}}{{#if _gte participants.length '2'}}<small class="text-muted">/{{participants.length}}</small>{{/if}}</span>
            {{#if isSuperuser}}
                {{#unless shortened}}
                    <button class="btn btn-warning {{#if round}}next-round{{else}}disabled{{/if}} pull-right"><i class="fa fa-step-forward"></i></button>
                {{else}}
                    <button class="btn btn-warning next-round-undo pull-right"><i class="fa fa-undo"></i></button>
                {{/unless}}
            {{/if}}
        </div>
    </div>
</template>

<template name="brainSession_ideas_current_round">
    {{#if round}}

        {{#if _lt ideas.count '3'}}
        <div class="clearfix" style="margin-top: 20px">
            <form id="idea-form" data-round="{{round}}" data-sheet="{{sheet}}" data-no="{{#if ideas.count}}{{ideas.count}}{{else}}0{{/if}}">
                <textarea class="idea form-control" placeholder="type your idea here" style="margin-bottom: 10px;"></textarea>
                <button type="submit" class="btn btn-lg btn-warning pull-right">
                    {{#if _lt ideas.count '2'}}
                        Next Idea
                    {{else}}
                        I'm done
                    {{/if}}
                </button>
            </form>
        </div>
        {{else}}
            <div class="alert alert-warning">Wait for the next round.</div>
        {{/if}}
        
        <div class="clearfix" style="margin-top: 20px;">
            {{#each ideas.list}}
                <div class="well well-sm">
                    {{#if text}}{{text}}{{else}}<span class="text-muted">your idea</span>{{/if}}
                </div>
            {{/each}}
        </div>

    {{/if}}
</template>
