<template name="brainSession">
    
    <div class="modal" id="user-setup-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title">
                        {{#if hasName}}
                            Hey, {{currentUser.profile.name}}!
                        {{else}}
                            Hey, stranger! 
                        {{/if}}
                    </h4>
                </div>
                <div class="modal-body">
                    <h4><strong>
                        {{#if hasName}}
                            You can change your name here:
                        {{else}}
                            What's your name?
                        {{/if}}
                    </strong></h4>
                    <input type="text" id="user-setup-modal-name" class="form-control input-lg" style="max-width: 200px;" autofocus="true">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Thanks, I'd like to be anonymous</button>
                    <button type="button" class="btn btn-primary" id="user-setup-modal-ok">
                        {{#if hasName}}
                            Change name!
                        {{else}}
                            Let's start!
                        {{/if}}
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="session-setup-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title">
                        Session title and description
                    </h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="session-setup-modal-title">Title</label>
                        <input type="text" class="form-control" id="session-setup-modal-title" value="{{title}}">
                    </div>
                    <div class="form-group">
                        <label for="session-setup-modal-desc">Description</label>
                        <textarea id="session-setup-modal-desc" class="form-control">{{desc}}</textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="session-setup-modal-ok">
                        Confirm
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        
        <div class="col-sm-3">
            <div class="well well-sm">
                {{#unless closed}}
                    <div class="text-center">
                        {{> brainSession_round_info}}
                        {{> brainSession_timer}}
                        {{> brainSession_actions}}
                    </div>
                {{else}}
                    <h2>Finished</h2>
                {{/unless}}
                <hr/>
                {{> brainSession_participants}}
                <hr/>
                {{> brainSession_chat}}
            </div>
        </div>
        
        <div class="col-sm-9">
            <div class="well well-sm">
                {{> brainSession_info}}
                <hr>
                {{#if closed}}
                    {{> brainSession_ideas}}
                {{else}}
                    {{#if round}}
                        <div class="row">
                            <div class="col-sm-4">
                                {{> brainSession_ideas_current_round}}
                            </div>
                            <div class="col-sm-8">
                                {{> brainSession_ideas}}
                            </div>
                        </div>
                    {{/if}}
                {{/if}}
            </div>
        </div>

    </div>
</template>

<template name="brainSession_round_info">
    <h2 class="text-center">
        {{#if closed}}
            Finished
        {{else}}
            {{#if round}}
                Round {{round}}
            {{else}}
                Not started
            {{/if}}
        {{/if}}
    </h2>
</template>

<template name="brainSession_info">
    {{#if isSuperuser}}
    
        <div class="session-setup-modal-open clickable">
            <h2 id="session-title" class="{{#unless title}}empty{{/unless}}">
                {{#if title}}
                    {{title}}
                {{else}}
                    No title
                {{/if}}
            </h2>

            <p id="session-desc" class="{{#unless desc}}empty{{/unless}}">
                {{#if desc}}
                    {{{nlToBreak desc}}}
                {{else}}
                    No description
                {{/if}}
            </p>
        </div>
        
        <p>
            Share this link to invite people: <input type="text" class="form-control link-input" value="{{linkForParticipants}}" onClick="this.select();"><br/>
            Your admin link: <input type="text" class="form-control link-input" value="{{linkForAdmins}}" onClick="this.select();">
        </p>
        
    {{else}}
    
        {{#if title}}
            <h2 class="{{#unless title}}empty{{/unless}}">{{title}}</h2>
        {{else}}
            no title
        {{/if}}
        
        {{#if desc}}
            <p>{{{nlToBreak desc}}}</p>
        {{/if}}
    
    {{/if}}
    

</template>

<template name="brainSession_timer">
    <h2 id="timer" class="clearfix text-center" style="{{#if $lt timerSeconds '10'}}color:red;{{/if}}">
        <div id="timer-knob" data-minutes="{{roundLength}}">
            <input type="text" value="0" class="dial">
        </div>
        <div>
            {{formatDuration timerSeconds}}
        </div>
    </h2>
</template>

<template name="brainSession_participants">
    {{#if participants}}
        Participants ({{getLength participants}}):    
        <ul class="list-unstyled">
        {{#each participants}}
            <li>
                {{#unless closed}}
                    <i class="fa fa-fw fa-check-circle" style="{{#unless activity.ready}}color:#ccc;{{/unless}}"></i>
                {{/unless}}
                
                <span class="{{#if _eq currentUser._id this._id}}user-setup-modal-open clickable{{/if}}">{{userName this}}</span>
                
                {{#if activity.write}}
                    <i class="fa fa-pencil faa-horizontal animated"></i>
                {{/if}}
            </li>
        {{/each}}
        </ul>
    {{/if}}
</template>

<template name="brainSession_actions">
    {{#unless closed}}
        {{#if isSuperuser}}
            <div class="btn-group">
                {{#if round}}
                    <button class="next-round btn btn-primary">Next round</button>
                    <button class="end-session btn btn-default">End session</button>
                {{else}}
                    <button class="next-round btn btn-primary">Start session</button>
                {{/if}}
            </div>
        {{/if}}
    {{/unless}}
</template>

<template name="brainSession_chat">
    <h2>Chat</h2>
    {{#if messages}}
        <ul class="list-unstyled" id="chat">
        {{#each messages}}
            <li>
                <span class="label {{#if _neq author currentUser._id}}label-primary{{else}}label-default{{/if}}">{{userNameById author}}:</span>
                {{text}}
                <span class="text-muted" title="{{formatDate time 'YYYY/MM/DD HH:mm'}}">{{formatDate time 'HH:mm'}}</span>
            </li>
        {{else}}
            <li><em>be first to write a message!</em></li>
        {{/each}}
        </ul>
    {{/if}}
    <form id="chat-send-message">
        <input type="text" class="form-control" placeholder="your message">
    </form>
</template>

<template name="brainSession_ideas">
    
    {{#if ideas}}
        {{#if closed}}
            <h2>All ideas</h2>
        {{else}}
            <h2>Previous ideas</h2>
        {{/if}}

        {{#each ideas}}
            {{#if text}}
                <div class="well well-sm">
                    <span class="text-muted">Round: {{round}}</span>
                    {{#if ../closed}}
                        | <span class="text-muted">Author: {{userName author}}</span>
                    {{/if}}
                    <br/>
                    {{{nlToBreak text}}}
                </div>
            {{/if}}
        {{/each}}
    {{else}}
        no ideas
    {{/if}}
    
</template>

<template name="brainSession_ideas_current_round">
    {{#if round}}
        <h2>Your ideas in round {{round}}</h2>
        <div data-round="{{round}}" data-sheet="{{sheet}}">
            {{#each ideasPerRound}}
                <textarea data-no="{{this}}" class="idea form-control" style="margin-bottom:10px;"></textarea>
            {{/each}}
        </div>
        <button id="submit-ideas" class="btn btn-primary btn-lg btn-block stylish-clicked">
            {{#if isUserReady}}
                <i class="fa fa-check"></i>
            {{/if}}
            Submit
        </button>
    {{/if}}
</template>
