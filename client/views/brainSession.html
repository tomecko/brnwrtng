<template name="brainSession">

    {{> brainSession_modals linkForParticipants=linkForParticipants linkForAdmins=linkForAdmins}}
        
    <div class="container-fluid">
    <div class="row">
        
        <div class="col-sm-3">
            <div class="well well-sm">
                {{#unless closed}}
                    <div class="text-center">
                        {{> brainSession_round_info}}
                        {{> brainSession_timer}}
                    </div>
                    <hr/>
                {{/unless}}
                {{> brainSession_participants}}
                <hr/>
                {{> brainSession_chat}}
            </div>
        </div>
        
        <div class="col-sm-9">
            <div class="well well-sm">
                {{> brainSession_info linkForParticipants=linkForParticipants title=title}}
                <hr>
                {{#if closed}}
                    {{> brainSession_ideas}}
                {{else}}
                    {{#if round}}
                        <div class="row">
                            <div class="col-sm-4">
                                {{> brainSession_ideas_current_round}}
                            </div>
                            <div class="col-sm-8">
                                {{> brainSession_ideas}}
                            </div>
                        </div>
                    {{else}}
                        <h2>Session hasn't begun yet.</h2>
                    {{/if}}
                {{/if}}
            </div>
        </div>

    </div>
    </div>
</template>

<template name="brainSession_round_info">
    <h2 class="text-center">
        {{#if round}}
            Round {{round}}
        {{else}}
            Not started
        {{/if}}
    </h2>
</template>

<template name="brainSession_info">
    {{#if isSuperuser}}
    
        <div class="session-edit-modal-open clickable">
            <h2 id="session-title" class="{{#unless title}}empty{{/unless}}">
                {{#if title}}
                    {{title}}
                {{else}}
                    No subject
                {{/if}}
            </h2>

            {{!--
            <p id="session-desc" class="{{#unless desc}}empty{{/unless}}">
                {{#if desc}}
                    {{{nlToBreak desc}}}
                {{else}}
                    No description
                {{/if}}
            </p>
            --}}
        </div>
        
        {{!--
        <p>
            Share this link to invite people: <input type="text" class="form-control link-input" value="{{linkForParticipants}}" onClick="this.select();"><br/>
            Your admin link: <input type="text" class="form-control link-input" value="{{linkForAdmins}}" onClick="this.select();">
        </p>
        --}}
        
    {{else}}
    
        {{#if title}}
            <h2 class="{{#unless title}}empty{{/unless}}">{{title}}</h2>
        {{else}}
            no subject
        {{/if}}
        
        {{!--
        {{#if desc}}
            <p>{{{nlToBreak desc}}}</p>
        {{/if}}
        --}}
    
    {{/if}}

</template>

<template name="brainSession_timer">
    <h2 id="timer" class="clearfix text-center {{#if _lt timerSeconds 5}}warn{{/if}}">
        <div id="timer-knob" data-minutes="{{roundLength}}">
            <input type="text" value="0" class="dial">
        </div>
        <div>
            {{formatDuration timerSeconds}}
        </div>
    </h2>
    {{#unless closed}}
        {{#if isSuperuser}}
            {{#if round}}
                {{#if shortened}}
                    <button class="next-round-undo btn btn-primary">Undo</button>
                {{else}}
                    <button class="next-round btn btn-primary" data-toggle="tooltip" data-animation="true" data-html="true" data-placement="bottom" data-trigger="manual" data-title="It seems everybody&#39;s<br/>ready for the next round.<br/>You may want to click<br/>&quot;Next Round&quot; button.">Next Round</button>&nbsp;<button class="end-session btn btn-default">End Brainwriting</button>
                {{/if}}
            {{else}}
                <button class="next-round btn btn-lg btn-primary">Start Brainwriting</button>
            {{/if}}
        {{/if}}
    {{/unless}}
</template>

<template name="brainSession_participants">
    {{#if participants}}
        <h2>People
            <button class="btn btn-sm btn-primary session-links-modal-open">
                <i class="fa fa-plus"></i> invite
            </button>
            {{!--<small>({{getLength participants}})</small>--}}
        </h2>
        <ul class="list-unstyled blink blink-fast">
        {{#each participants}}
            <li class="{{#if activity.ready}}bg-primary{{/if}}">
                {{#unless ../closed}}
                    <i class="fa fa-fw fa-check-circle primary-color" style="{{#if activity.ready}}color:#fff;{{/if}}"></i>
                {{/unless}}
                
                <span class="{{#if _eq currentUser._id this._id}}name-edit-modal-open clickable{{/if}}">{{userName this}}</span>
                
                {{#if activity.write}}
                    <i class="fa fa-pencil faa-horizontal animated"></i>
                {{/if}}
            </li>
        {{/each}}
        </ul>
    {{/if}}
</template>

<template name="brainSession_chat">
    <h2>Chat</h2>
    {{#if messages}}
        <ul class="list-unstyled" id="chat">
        {{#each messages}}
            <li>
                <span class="label {{#if _neq author currentUser._id}}label-primary{{else}}label-default{{/if}}">{{userNameById author}}:</span>
                {{text}}
                <span class="text-muted" title="{{formatDate time 'YYYY/MM/DD HH:mm'}}">{{formatDate time 'HH:mm'}}</span>
            </li>
        {{else}}
            <li><em>be first to write a message!</em></li>
        {{/each}}
        </ul>
    {{/if}}
    <form id="chat-send-message">
        <input type="text" class="form-control" placeholder="your message">
    </form>
</template>

<template name="brainSession_ideas">
    
    {{#if ideas}}
        {{#if closed}}
            <h2>
                All ideas
                <button class="btn btn-primary" onclick="alert('Sorry, this hasn\'t been implemented yet!\n\nWhat did you expect to happen?');">export to file</button>
            </h2>
            <p>
                sort by
                <div class="btn-group all-ideas-sorting">
                    <button class="btn {{#if sessionEquals 'allIdeasSorting' 'round'}}btn-primary{{else}}btn-default{{/if}}" data-sort-by="round">round</button>
                    <button class="btn {{#if sessionEquals 'allIdeasSorting' 'author'}}btn-primary{{else}}btn-default{{/if}}" data-sort-by="author">author</button>
                    <button class="btn {{#if sessionEquals 'allIdeasSorting' 'likes'}}btn-primary{{else}}btn-default{{/if}}" data-sort-by="likes">likes</button>
                </div>
            </p>
        {{else}}
            {{#if _gt round 1}}
                <h2>Others' random ideas</h2>
                <p>Read other people's ideas for inspiration. Feel free to expand on them.</p>
            {{/if}}
        {{/if}}

        <div class="clearfix">
        {{#each ideas}}
            {{#if text}}
                <div class="well well-sm idea-box">
                    <span class="text-muted">Round: {{round}}</span>
                    {{#if ../closed}}
                        | <span class="text-muted">Author: {{userName author}}</span>
                        <span class="pull-right">{{#if _len likedBy}}{{_len likedBy}}{{/if}} <i class="fa fa-star{{#unless _inArray likedBy currentUser._id}}-o{{/unless}} primary-color idea-box-like clickable" title="{{#if _inArray likedBy currentUser._id}}unlike{{else}}like{{/if}}"></i></span>
                    {{/if}}
                    <br/>
                    {{{nlToBreak text}}}
                </div>
            {{/if}}
        {{/each}}
        </div>
    {{else}}
        no ideas
    {{/if}}
    
</template>

<template name="brainSession_ideas_current_round">
    {{#if round}}
        <h2>Your ideas in round {{round}}</h2>
        <div data-round="{{round}}" data-sheet="{{sheet}}">
            {{#each ideasPerRound}}
                <textarea data-no="{{this}}" class="idea form-control" style="margin-bottom:10px;" placeholder="your idea #{{inc this}}"></textarea>
            {{/each}}
        </div>
        <button id="submit-ideas" class="btn btn-primary btn-lg btn-block stylish-clicked">
            {{#if isUserReady}}
                <i class="fa fa-check-circle"></i> Ideas sent
            {{else}}
                Send Ideas
            {{/if}}
        </button>
    {{/if}}
</template>
