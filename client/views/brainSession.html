<template name="brainSession">
    <div class="row">
        <div class="col-sm-3">
            <div class="well well-sm">
                {{#unless closed}}
                    <div class="text-center">
                        {{> brainSession_round_info}}
                        {{> brainSession_timer}}
                        {{> brainSession_actions}}
                    </div>
                {{else}}
                    <h2>Finished</h2>
                {{/unless}}
                <hr/>
                {{> brainSession_participants}}
                <hr/>
                {{> brainSession_chat}}
            </div>
        </div>
        
        <div class="col-sm-9">
            <div class="well well-sm">
                {{> brainSession_info}}
                <hr>
                {{#if closed}}
                    {{> brainSession_ideas}}
                {{else}}
                    {{#if round}}
                        <div class="row">
                            <div class="col-sm-4">
                                {{> brainSession_ideas_current_round}}
                            </div>
                            <div class="col-sm-8">
                                {{> brainSession_ideas}}
                            </div>
                        </div>
                    {{else}}
                        {{> brainSession_ready_buttons}}
                    {{/if}}
                {{/if}}
            </div>
        </div>

    </div>
</template>

<template name="brainSession_ready_buttons">
    {{#if round}}
	{{#if isUserNotReady}}
        <button class="btn btn-primary btn-lg ready" data-ready="true">Submit and get ready for next round!</button>
	{{/if}}
    {{/if}}
</template>

<template name="brainSession_round_info">
    <h2 class="text-center">
        {{#if closed}}
            Finished
        {{else}}
            {{#if round}}
                Round {{round}}
            {{else}}
                Not started
            {{/if}}
        {{/if}}
    </h2>
</template>

<template name="brainSession_info">
    <h2>{{title}}</h2>
    <p>
        {{#if desc}}
            {{desc}}
        {{else}}
            <!--no description-->
        {{/if}}
    </p>
</template>

<template name="brainSession_timer">
    <h2 id="timer" class="clearfix text-center" style="{{#if $lt timerSeconds '10'}}color:red;{{/if}}">
        <div id="timer-knob" data-minutes="{{roundLength}}">
            <input type="text" value="0" class="dial">
        </div>
        <div>
            {{formatDuration timerSeconds}}
        </div>
    </h2>
</template>

<template name="brainSession_participants">
    {{#if participants}}
        Participants ({{getLength participants}}):    
        <ul class="list-unstyled">
        {{#each participants}}
            <li>
                {{#unless closed}}
                    <i class="fa fa-fw fa-check-circle" style="{{#unless activity.ready}}color:#ccc;{{/unless}}"></i>
                {{/unless}}

                {{userDisplayHelper this}}
                {{#if activity.write}}
                    <i class="fa fa-pencil"></i>
                {{/if}}
            </li>
        {{/each}}
        </ul>
    {{/if}}
</template>

<template name="brainSession_actions">
    {{#unless closed}}
        {{#if isSuperuser}}
            <div class="btn-group">
                {{#if round}}
                    <button class="next-round btn btn-primary">Next round</button>
                    <button class="end-session btn btn-default">End session</button>
                {{else}}
                    <button class="next-round btn btn-primary">Start session</button>
                {{/if}}
            </div>
        {{/if}}
    {{/unless}}
</template>

<template name="brainSession_chat">
    <h2>Chat</h2>
    {{#if messages}}
        <ul class="list-unstyled" id="chat">
        {{#each messages}}
            <li>
                <span class="label {{#if _neq author currentUser._id}}label-primary{{else}}label-default{{/if}}">{{user author}}:</span>
                {{text}}
                <span class="text-muted" title="{{formatDate time 'YYYY/MM/DD HH:mm'}}">{{formatDate time 'HH:mm'}}</span>
            </li>
        {{else}}
            <li><em>be first to write a message!</em></li>
        {{/each}}
        </ul>
    {{/if}}
    <form id="chat-send-message">
        <input type="text" class="form-control" placeholder="your message">
    </form>
</template>

<template name="brainSession_ideas">
    
    {{#if _neq round 1}}
        {{#if closed}}
            <h2>All ideas</h2>
        {{else}}
            <h2>Previous ideas</h2>
        {{/if}}

        {{#each ideas}}
            {{#if text}}
                <div class="well well-sm">
                    <span class="text-muted">Round: {{round}}</span>
                    {{#if ../closed}}
                        | <span class="text-muted">Author: {{emailHelper author}}</span>
                    {{/if}}
                    <br/>
                    {{{nlToBreak text}}}
                </div>
            {{/if}}
        {{else}}
            no ideas
        {{/each}}
    {{/if}}
    
</template>

<template name="brainSession_ideas_current_round">
    {{#if round}}
	{{#if isUserNotReady}}
            <h2>Your ideas in round {{round}}</h2>
            <div data-round="{{round}}" data-sheet="{{sheet}}">
                {{#each ideasPerRound}}
                    <textarea data-no="{{this}}" class="form-control" style="margin-bottom:10px;"></textarea>
                {{/each}}
            </div>
	{{else}}
	    <h2>Get ready for the next round!</h2>
	{{/if}}
        {{> brainSession_ready_buttons}}
    {{/if}}
</template>
